<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GRAND Restaurant - Система управления</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --black: #0A0A0A;
            --gold: #D4AF37;
            --gold-dark: #B8941F;
            --gold-light: #F5E6C8;
            --bg-main: #0A0A0A;
            --bg-card: #1A1A1A;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0A0;
            --border: #2A2A2A;
            --success: #4CAF50;
            --danger: #F44336;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
        }

        #root {
            min-height: 100vh;
            padding-bottom: 70px;
        }

        /* Header (только лого, без поиска) */
        .header {
            position: sticky;
            top: 0;
            background: var(--bg-main);
            padding: 16px 20px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-size: 24px;
            font-weight: 900;
            letter-spacing: 2px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        .logo-subtitle {
            font-size: 8px;
            letter-spacing: 4px;
            color: var(--text-secondary);
            text-align: center;
            margin-top: -4px;
        }

        /* Home Menu */
        .home-container {
            padding: 20px;
        }

        .menu-grid {
            display: grid;
            gap: 16px;
        }

        .menu-grid.three-buttons {
            grid-template-columns: repeat(2, 1fr);
        }

        .menu-grid.three-buttons .menu-card:last-child {
            grid-column: 1 / -1;
        }

        .menu-grid.four-buttons {
            grid-template-columns: repeat(2, 1fr);
        }

        .menu-card {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            border-radius: 16px;
            padding: 32px 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(212, 175, 55, 0.4);
        }

        .menu-card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--black);
        }

        /* Warehouse Table */
        .warehouse-container {
            padding: 0 20px 20px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            padding: 16px 20px 0;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--gold);
            border-bottom-color: var(--gold);
        }

        .table-wrapper {
            overflow-x: auto;
            margin-top: 16px;
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: var(--bg-card);
            border-radius: 8px;
            overflow: hidden;
        }

        .data-table thead {
            background: var(--bg-main);
        }

        .data-table th {
            padding: 14px 12px;
            text-align: left;
            font-size: 12px;
            font-weight: 700;
            color: var(--gold);
            text-transform: uppercase;
            border-bottom: 2px solid var(--border);
            white-space: nowrap;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .data-table tr:hover td {
            background: rgba(212, 175, 55, 0.05);
        }

        .data-table td.editable:hover {
            background: rgba(212, 175, 55, 0.1);
            outline: 1px solid var(--gold);
        }

        .cell-input {
            width: 100%;
            background: var(--bg-main);
            border: 2px solid var(--gold);
            padding: 12px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .category-badge {
            display: inline-block;
            padding: 4px 12px;
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .quantity-cell {
            font-weight: 600;
            color: var(--gold);
        }

        .quantity-cell.low {
            color: var(--danger);
        }

        .id-cell {
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
        }

        /* Orders Container */
        .orders-container {
            padding: 20px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 16px;
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
        }

        .filter-chip {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-chip.active {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
            border-color: var(--gold);
        }

        /* Order Card */
        .order-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .order-number {
            font-size: 16px;
            font-weight: 700;
            color: var(--gold);
        }

        .order-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .order-items {
            margin: 12px 0;
            padding-left: 16px;
        }

        .order-item {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .order-footer {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }

        .order-timer {
            color: var(--danger);
            font-weight: 600;
        }

        /* Accordion */
        .accordion {
            margin-top: 32px;
            border-top: 2px solid var(--border);
            padding-top: 20px;
        }

        .accordion-item {
            margin-bottom: 12px;
        }

        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .accordion-header:hover {
            border-color: var(--gold);
        }

        .accordion-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .accordion-icon {
            font-size: 20px;
            transition: transform 0.3s;
        }

        .accordion-icon.expanded {
            transform: rotate(180deg);
        }

        .accordion-content {
            padding: 16px;
            display: none;
        }

        .accordion-content.expanded {
            display: block;
        }

        /* Forecast */
        .forecast-options {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .forecast-btn {
            flex: 1;
            padding: 10px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .forecast-btn.active {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
            border-color: var(--gold);
        }

        .forecast-result {
            padding: 16px;
            background: var(--bg-main);
            border-radius: 8px;
            border-left: 4px solid var(--gold);
            font-size: 14px;
            line-height: 1.6;
        }

        .forecast-highlight {
            color: var(--gold);
            font-weight: 700;
        }

        /* Low Stock List */
        .low-stock-item {
            background: var(--bg-card);
            border: 1px solid var(--danger);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .low-stock-name {
            font-size: 16px;
            font-weight: 600;
        }

        .low-stock-details {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .low-stock-quantity {
            background: var(--danger);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 700;
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            border: none;
            background: none;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .nav-item.active {
            color: var(--gold);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: flex-end;
            z-index: 2000;
            animation: fadeIn 0.3s;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 10;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--gold);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 28px;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        /* Order Form */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--gold);
        }

        .quick-select {
            margin-bottom: 20px;
        }

        .quick-select-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-secondary);
        }

        .quick-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .quick-chip {
            padding: 8px 16px;
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-chip:hover {
            border-color: var(--gold);
            color: var(--gold);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-input,
        .form-select {
            width: 100%;
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-row {
            display: flex;
            gap: 12px;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
        }

        .btn-secondary {
            background: var(--bg-main);
            color: var(--text-primary);
            border: 1px solid var(--border);
            margin-top: 12px;
        }

        .current-order {
            margin: 20px 0;
            padding: 16px;
            background: var(--bg-main);
            border-radius: 8px;
            border-left: 4px solid var(--gold);
        }

        .current-order-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--gold);
        }

        .current-order-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .current-order-item:last-child {
            border-bottom: none;
        }

        .loading,
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const API_URL = 'https://percy-untrundled-unseraphically.ngrok-free.app';
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        const USER_ROLE = 'admin';

        function App() {
            const [currentTab, setCurrentTab] = useState('home');
            const [warehouseTab, setWarehouseTab] = useState('all');
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [categories, setCategories] = useState([]);
            const [searchQuery, setSearchQuery] = useState('');
            const [editingCell, setEditingCell] = useState(null);
            const [showOrderModal, setShowOrderModal] = useState(false);
            const [currentOrder, setCurrentOrder] = useState([]);
            const [orderForm, setOrderForm] = useState({ product: '', quantity: '', unit: 'кг' });
            const [categoryFilter, setCategoryFilter] = useState('all');
            const [forecastDays, setForecastDays] = useState(3);
            const [forecastExpanded, setForecastExpanded] = useState(false);
            const [lowStockExpanded, setLowStockExpanded] = useState(false);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadProducts();
                loadOrders();
            }, []);

            useEffect(() => {
                const interval = setInterval(() => {
                    checkExpiredOrders();
                }, 60000); // Каждую минуту
                return () => clearInterval(interval);
            }, [orders]);

            const loadProducts = async () => {
                setLoading(true);
                try {
                    const mockProducts = [
                        { id: 1, name: 'Помидоры', category: 'Овощи', price: 150, quantity: 25, unit: 'кг', dailyUsage: 8 },
                        { id: 2, name: 'Курица', category: 'Мясо', price: 350, quantity: 8, unit: 'кг', dailyUsage: 5 },
                        { id: 3, name: 'Картофель', category: 'Овощи', price: 80, quantity: 50, unit: 'кг', dailyUsage: 12 },
                        { id: 4, name: 'Говядина', category: 'Мясо', price: 550, quantity: 5, unit: 'кг', dailyUsage: 3 },
                        { id: 5, name: 'Лук', category: 'Овощи', price: 60, quantity: 30, unit: 'кг', dailyUsage: 6 },
                        { id: 6, name: 'Яйца', category: 'Молочное', price: 5, quantity: 120, unit: 'шт', dailyUsage: 50 },
                        { id: 7, name: 'Молоко', category: 'Молочное', price: 80, quantity: 7, unit: 'л', dailyUsage: 4 },
                    ];
                    setProducts(mockProducts);
                    const uniqueCategories = [...new Set(mockProducts.map(p => p.category))];
                    setCategories(uniqueCategories);
                } catch (error) {
                    console.error('Ошибка загрузки:', error);
                } finally {
                    setLoading(false);
                }
            };

            const loadOrders = () => {
                const savedOrders = localStorage.getItem('grand_orders');
                if (savedOrders) {
                    setOrders(JSON.parse(savedOrders));
                }
            };

            const saveOrders = (newOrders) => {
                localStorage.setItem('grand_orders', JSON.stringify(newOrders));
                setOrders(newOrders);
            };

            const handleCellEdit = (productId, field, value) => {
                setProducts(products.map(p => 
                    p.id === productId ? { ...p, [field]: value } : p
                ));
                setEditingCell(null);
            };

            const handleQuickSelect = (productName) => {
                const product = products.find(p => p.name === productName);
                if (product) {
                    setOrderForm({ product: product.name, quantity: '', unit: product.unit });
                }
            };

            const handleAddToOrder = () => {
                if (!orderForm.product || !orderForm.quantity) {
                    tg.showAlert('Заполните все поля');
                    return;
                }
                const newItem = { ...orderForm, id: Date.now() };
                setCurrentOrder([...currentOrder, newItem]);
                setOrderForm({ product: '', quantity: '', unit: 'кг' });
            };

            const handleRemoveFromOrder = (itemId) => {
                setCurrentOrder(currentOrder.filter(item => item.id !== itemId));
            };

            const handleCreateOrder = () => {
                if (currentOrder.length === 0) {
                    tg.showAlert('Добавьте товары в заказ');
                    return;
                }
                
                const orderCategories = [...new Set(currentOrder.map(item => {
                    const product = products.find(p => p.name === item.product);
                    return product ? product.category : 'Другое';
                }))];

                const newOrder = {
                    id: Date.now(),
                    number: `ORD-${String(orders.length + 1).padStart(3, '0')}`,
                    items: currentOrder,
                    categories: orderCategories,
                    createdAt: new Date().toISOString(),
                    completed: false,
                    completedAt: null
                };

                saveOrders([newOrder, ...orders]);
                setCurrentOrder([]);
                setShowOrderModal(false);
                tg.showPopup({ message: 'Заказ создан!', buttons: [{ type: 'ok' }] });
            };

            const handleToggleComplete = (orderId) => {
                const updatedOrders = orders.map(order => {
                    if (order.id === orderId) {
                        return {
                            ...order,
                            completed: !order.completed,
                            completedAt: !order.completed ? new Date().toISOString() : null
                        };
                    }
                    return order;
                });
                saveOrders(updatedOrders);
            };

            const checkExpiredOrders = () => {
                const now = new Date().getTime();
                const filteredOrders = orders.filter(order => {
                    if (order.completed && order.completedAt) {
                        const completedTime = new Date(order.completedAt).getTime();
                        const hoursPassed = (now - completedTime) / (1000 * 60 * 60);
                        return hoursPassed < 24;
                    }
                    return true;
                });
                
                if (filteredOrders.length !== orders.length) {
                    saveOrders(filteredOrders);
                }
            };

            const getTimeRemaining = (completedAt) => {
                if (!completedAt) return null;
                const now = new Date().getTime();
                const completedTime = new Date(completedAt).getTime();
                const hoursPassed = (now - completedTime) / (1000 * 60 * 60);
                const hoursRemaining = Math.max(0, 24 - hoursPassed);
                return Math.floor(hoursRemaining);
            };

            const filteredProducts = products.filter(product => {
                if (!searchQuery) return true;
                const query = searchQuery.toLowerCase();
                return product.name.toLowerCase().includes(query) ||
                       product.category.toLowerCase().includes(query);
            });

            const lowStockProducts = products.filter(p => p.quantity < 10);
            const displayProducts = warehouseTab === 'low' ? lowStockProducts : filteredProducts;

            const filteredOrders = categoryFilter === 'all' 
                ? orders 
                : orders.filter(order => order.categories.includes(categoryFilter));

            const getForecast = () => {
                const results = lowStockProducts.map(p => {
                    const daysRemaining = Math.floor(p.quantity / p.dailyUsage);
                    const needToOrder = Math.max(0, (p.dailyUsage * forecastDays) - p.quantity);
                    return { ...p, daysRemaining, needToOrder };
                });
                return results;
            };

            const forecastResults = getForecast();

            return (
                <>
                    <div className="header">
                        <div className="logo">GRAND</div>
                        <div className="logo-subtitle">RESTAURANT</div>
                    </div>

                    {/* Home Menu */}
                    {currentTab === 'home' && (
                        <div className="home-container">
                            <div className={`menu-grid ${USER_ROLE === 'admin' ? 'four-buttons' : 'three-buttons'}`}>
                                <div className="menu-card" onClick={() => setCurrentTab('warehouse')}>
                                    <div className="menu-card-title">Склад</div>
                                </div>
                                <div className="menu-card" onClick={() => setCurrentTab('orders')}>
                                    <div className="menu-card-title">Закупки</div>
                                </div>
                                {USER_ROLE === 'admin' && (
                                    <div className="menu-card" onClick={() => tg.showAlert('Редактирование доступно в разделе Склад')}>
                                        <div className="menu-card-title">Редактировать</div>
                                    </div>
                                )}
                                <div className="menu-card" onClick={() => setShowOrderModal(true)}>
                                    <div className="menu-card-title">Заказать</div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Warehouse */}
                    {currentTab === 'warehouse' && (
                        <>
                            <div className="tabs">
                                <button
                                    className={`tab ${warehouseTab === 'all' ? 'active' : ''}`}
                                    onClick={() => setWarehouseTab('all')}
                                >
                                    Все продукты
                                </button>
                                <button
                                    className={`tab ${warehouseTab === 'low' ? 'active' : ''}`}
                                    onClick={() => setWarehouseTab('low')}
                                >
                                    Низкие остатки ({lowStockProducts.length})
                                </button>
                            </div>
                            <div className="warehouse-container">
                                {loading ? (
                                    <div className="loading">Загрузка...</div>
                                ) : (
                                    <div className="table-wrapper">
                                        <table className="data-table">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Название</th>
                                                    <th>Категория</th>
                                                    <th>Цена (€)</th>
                                                    <th>Кол-во</th>
                                                    <th>Ед.</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {displayProducts.map(product => (
                                                    <tr key={product.id}>
                                                        <td className="id-cell">{product.id}</td>
                                                        <td
                                                            className={USER_ROLE !== 'viewer' ? 'editable' : ''}
                                                            onClick={() => USER_ROLE !== 'viewer' && setEditingCell({ id: product.id, field: 'name' })}
                                                        >
                                                            {editingCell?.id === product.id && editingCell?.field === 'name' ? (
                                                                <input
                                                                    className="cell-input"
                                                                    type="text"
                                                                    defaultValue={product.name}
                                                                    autoFocus
                                                                    onBlur={(e) => handleCellEdit(product.id, 'name', e.target.value)}
                                                                    onKeyDown={(e) => e.key === 'Enter' && handleCellEdit(product.id, 'name', e.target.value)}
                                                                />
                                                            ) : product.name}
                                                        </td>
                                                        <td><span className="category-badge">{product.category}</span></td>
                                                        <td
                                                            className={USER_ROLE !== 'viewer' ? 'editable' : ''}
                                                            onClick={() => USER_ROLE !== 'viewer' && setEditingCell({ id: product.id, field: 'price' })}
                                                        >
                                                            {editingCell?.id === product.id && editingCell?.field === 'price' ? (
                                                                <input
                                                                    className="cell-input"
                                                                    type="number"
                                                                    defaultValue={product.price}
                                                                    autoFocus
                                                                    onBlur={(e) => handleCellEdit(product.id, 'price', parseFloat(e.target.value))}
                                                                    onKeyDown={(e) => e.key === 'Enter' && handleCellEdit(product.id, 'price', parseFloat(e.target.value))}
                                                                />
                                                            ) : product.price}
                                                        </td>
                                                        <td
                                                            className={`quantity-cell ${product.quantity < 10 ? 'low' : ''} ${USER_ROLE !== 'viewer' ? 'editable' : ''}`}
                                                            onClick={() => USER_ROLE !== 'viewer' && setEditingCell({ id: product.id, field: 'quantity' })}
                                                        >
                                                            {editingCell?.id === product.id && editingCell?.field === 'quantity' ? (
                                                                <input
                                                                    className="cell-input"
                                                                    type="number"
                                                                    defaultValue={product.quantity}
                                                                    autoFocus
                                                                    onBlur={(e) => handleCellEdit(product.id, 'quantity', parseFloat(e.target.value))}
                                                                    onKeyDown={(e) => e.key === 'Enter' && handleCellEdit(product.id, 'quantity', parseFloat(e.target.value))}
                                                                />
                                                            ) : product.quantity}
                                                        </td>
                                                        <td>{product.unit}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>
                        </>
                    )}

                    {/* Orders */}
                    {currentTab === 'orders' && (
                        <div className="orders-container">
                            <div className="section-title">Созданные заказы</div>
                            
                            <div className="filters">
                                <div
                                    className={`filter-chip ${categoryFilter === 'all' ? 'active' : ''}`}
                                    onClick={() => setCategoryFilter('all')}
                                >
                                    Все
                                </div>
                                {categories.map(cat => (
                                    <div
                                        key={cat}
                                        className={`filter-chip ${categoryFilter === cat ? 'active' : ''}`}
                                        onClick={() => setCategoryFilter(cat)}
                                    >
                                        {cat}
                                    </div>
                                ))}
                            </div>

                            {filteredOrders.length === 0 ? (
                                <div className="empty-state">Нет заказов</div>
                            ) : (
                                filteredOrders.map(order => (
                                    <div key={order.id} className="order-card">
                                        <div className="order-header">
                                            <div className="order-number">#{order.number}</div>
                                            <input
                                                type="checkbox"
                                                className="order-checkbox"
                                                checked={order.completed}
                                                onChange={() => handleToggleComplete(order.id)}
                                            />
                                        </div>
                                        <div className="order-items">
                                            {order.items.map((item, idx) => (
                                                <div key={idx} className="order-item">
                                                    • {item.product} - {item.quantity} {item.unit}
                                                </div>
                                            ))}
                                        </div>
                                        <div className="order-footer">
                                            <span>Создан: {new Date(order.createdAt).toLocaleString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</span>
                                            {order.completed && order.completedAt && (
                                                <span className="order-timer">
                                                    Удалится через: {getTimeRemaining(order.completedAt)} ч
                                                </span>
                                            )}
                                        </div>
                                    </div>
                                ))
                            )}

                            {/* Accordions */}
                            <div className="accordion">
                                <div className="accordion-item">
                                    <div className="accordion-header" onClick={() => setForecastExpanded(!forecastExpanded)}>
                                        <div className="accordion-title">Прогноз остатков</div>
                                        <div className={`accordion-icon ${forecastExpanded ? 'expanded' : ''}`}>▼</div>
                                    </div>
                                    <div className={`accordion-content ${forecastExpanded ? 'expanded' : ''}`}>
                                        <div className="forecast-options">
                                            <button
                                                className={`forecast-btn ${forecastDays === 3 ? 'active' : ''}`}
                                                onClick={() => setForecastDays(3)}
                                            >
                                                3 дня
                                            </button>
                                            <button
                                                className={`forecast-btn ${forecastDays === 5 ? 'active' : ''}`}
                                                onClick={() => setForecastDays(5)}
                                            >
                                                5 дней
                                            </button>
                                            <button
                                                className={`forecast-btn ${forecastDays === 7 ? 'active' : ''}`}
                                                onClick={() => setForecastDays(7)}
                                            >
                                                7 дней
                                            </button>
                                        </div>
                                        <div className="forecast-result">
                                            На складе <span className="forecast-highlight">{lowStockProducts.length}</span> продуктов с низкими остатками.
                                            <br/>
                                            При текущем потреблении запасов хватит на{' '}
                                            <span className="forecast-highlight">
                                                {forecastResults.length > 0 ? Math.min(...forecastResults.map(r => r.daysRemaining)) : 0} дней
                                            </span>.
                                            <br/>
                                            Для работы {forecastDays} дней необходимо заказать на сумму{' '}
                                            <span className="forecast-highlight">
                                                {forecastResults.reduce((sum, r) => sum + (r.needToOrder * r.price), 0).toFixed(2)} €
                                            </span>.
                                        </div>
                                    </div>
                                </div>

                                <div className="accordion-item">
                                    <div className="accordion-header" onClick={() => setLowStockExpanded(!lowStockExpanded)}>
                                        <div className="accordion-title">Требуется заказать</div>
                                        <div className={`accordion-icon ${lowStockExpanded ? 'expanded' : ''}`}>▼</div>
                                    </div>
                                    <div className={`accordion-content ${lowStockExpanded ? 'expanded' : ''}`}>
                                        {lowStockProducts.length === 0 ? (
                                            <div className="empty-state">Все остатки в норме</div>
                                        ) : (
                                            forecastResults.map(item => (
                                                <div key={item.id} className="low-stock-item">
                                                    <div>
                                                        <div className="low-stock-name">{item.name}</div>
                                                        <div className="low-stock-details">
                                                            {item.category} • Осталось на {item.daysRemaining} дней • Нужно: {item.needToOrder} {item.unit}
                                                        </div>
                                                    </div>
                                                    <div className="low-stock-quantity">
                                                        {item.quantity} {item.unit}
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Bottom Nav */}
                    <div className="bottom-nav">
                        <button className={`nav-item ${currentTab === 'warehouse' ? 'active' : ''}`} onClick={() => setCurrentTab('warehouse')}>
                            Склад
                        </button>
                        <button className={`nav-item ${currentTab === 'orders' ? 'active' : ''}`} onClick={() => setCurrentTab('orders')}>
                            Закупки
                        </button>
                        <button className={`nav-item ${currentTab === 'home' ? 'active' : ''}`} onClick={() => setCurrentTab('home')}>
                            Главное
                        </button>
                    </div>

                    {/* Order Modal */}
                    {showOrderModal && (
                        <div className="modal-overlay" onClick={() => setShowOrderModal(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <div className="modal-title">Создать заказ</div>
                                    <button className="modal-close" onClick={() => setShowOrderModal(false)}>×</button>
                                </div>
                                <div className="modal-body">
                                    <div className="search-box">
                                        <input
                                            type="text"
                                            className="search-input"
                                            placeholder="Поиск товаров..."
                                            value={searchQuery}
                                            onChange={(e) => setSearchQuery(e.target.value)}
                                        />
                                    </div>

                                    <div className="quick-select">
                                        <div className="quick-select-title">Быстрый выбор:</div>
                                        <div className="quick-chips">
                                            {products.slice(0, 6).map(product => (
                                                <div
                                                    key={product.id}
                                                    className="quick-chip"
                                                    onClick={() => handleQuickSelect(product.name)}
                                                >
                                                    {product.name}
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Продукт</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={orderForm.product}
                                            onChange={(e) => setOrderForm({...orderForm, product: e.target.value})}
                                            placeholder="Название продукта"
                                        />
                                    </div>

                                    <div className="form-row">
                                        <div className="form-group" style={{flex: 2}}>
                                            <label className="form-label">Количество</label>
                                            <input
                                                type="number"
                                                className="form-input"
                                                value={orderForm.quantity}
                                                onChange={(e) => setOrderForm({...orderForm, quantity: e.target.value})}
                                                placeholder="0"
                                            />
                                        </div>
                                        <div className="form-group" style={{flex: 1}}>
                                            <label className="form-label">Единица</label>
                                            <select
                                                className="form-select"
                                                value={orderForm.unit}
                                                onChange={(e) => setOrderForm({...orderForm, unit: e.target.value})}
                                            >
                                                <option value="кг">кг</option>
                                                <option value="шт">шт</option>
                                                <option value="л">л</option>
                                                <option value="г">г</option>
                                            </select>
                                        </div>
                                    </div>

                                    <button className="btn btn-secondary" onClick={handleAddToOrder}>
                                        + Добавить в заказ
                                    </button>

                                    {currentOrder.length > 0 && (
                                        <div className="current-order">
                                            <div className="current-order-title">Текущий заказ:</div>
                                            {currentOrder.map(item => (
                                                <div key={item.id} className="current-order-item">
                                                    <span>• {item.product} - {item.quantity} {item.unit}</span>
                                                    <button
                                                        onClick={() => handleRemoveFromOrder(item.id)}
                                                        style={{background: 'none', border: 'none', color: 'var(--danger)', cursor: 'pointer'}}
                                                    >
                                                        ✕
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    <button className="btn btn-primary" onClick={handleCreateOrder}>
                                        Создать заказ
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
