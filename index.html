<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–ª–∞–¥–æ–º</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --black: #0A0A0A;
            --gold: #D4AF37;
            --gold-dark: #B8941F;
            --gold-light: #F5E6C8;
            --bg-main: #0A0A0A;
            --bg-card: #1A1A1A;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0A0;
            --border: #2A2A2A;
            --success: #4CAF50;
            --danger: #F44336;
            --warning: #FF9800;
            --blue: #2196F3;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        #root {
            min-height: 100vh;
            padding-bottom: 70px;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            background: var(--bg-main);
            padding: 16px 20px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .header-title {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .notification-icon {
            position: relative;
            font-size: 24px;
            cursor: pointer;
            color: var(--gold);
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger);
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: 700;
        }

        /* Search */
        .search-container {
            padding: 0;
            margin-top: 12px;
        }

        .search-input {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px 12px 40px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .search-wrapper {
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 16px;
        }

        /* Home Cards */
        .home-container {
            padding: 20px;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 20px;
        }

        .home-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 20px;
            padding: 24px 16px;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
        }

        .home-card.gold-gradient {
            background: linear-gradient(135deg, var(--gold-dark) 0%, var(--gold) 100%);
            border-color: var(--gold);
        }

        .home-card.black-gold {
            background: var(--bg-card);
            border-color: var(--gold);
        }

        .home-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(212, 175, 55, 0.3);
        }

        .home-card-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .home-card.gold-gradient .home-card-icon {
            filter: brightness(0) saturate(100%);
        }

        .home-card-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .home-card.gold-gradient .home-card-title {
            color: var(--black);
        }

        .home-card-subtitle {
            font-size: 12px;
            opacity: 0.7;
        }

        .home-card.gold-gradient .home-card-subtitle {
            color: var(--black);
        }

        /* Products Container */
        .products-container {
            padding: 0 20px 20px;
        }

        .product-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .product-card:hover {
            border-color: var(--gold);
            transform: translateY(-2px);
        }

        .product-card.low-stock {
            border-color: var(--danger);
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .product-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .product-id {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .product-category {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .product-details {
            display: flex;
            gap: 20px;
            margin-top: 12px;
        }

        .product-detail {
            flex: 1;
        }

        .detail-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--gold);
        }

        .detail-value.low {
            color: var(--danger);
        }

        .product-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .btn-action {
            flex: 1;
            padding: 8px 12px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-order {
            background: var(--gold);
            color: var(--black);
        }

        .btn-edit {
            background: var(--bg-main);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        /* Orders Table */
        .orders-container {
            padding: 0 20px 20px;
        }

        .order-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .order-number {
            font-size: 16px;
            font-weight: 700;
            color: var(--gold);
        }

        .order-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .order-status.new {
            background: var(--blue);
            color: white;
        }

        .order-status.processing {
            background: var(--warning);
            color: white;
        }

        .order-status.delivered {
            background: var(--success);
            color: white;
        }

        .order-status.paid {
            background: var(--gold);
            color: var(--black);
        }

        .order-items {
            border-top: 1px solid var(--border);
            padding-top: 12px;
            margin-top: 12px;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 14px;
        }

        .order-total {
            display: flex;
            justify-content: space-between;
            padding-top: 12px;
            margin-top: 12px;
            border-top: 1px solid var(--border);
            font-size: 16px;
            font-weight: 700;
            color: var(--gold);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: none;
        }

        .nav-item.active {
            color: var(--gold);
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }

        /* FAB */
        .fab {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--black);
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
            transition: all 0.3s;
            border: none;
            z-index: 999;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(212, 175, 55, 0.6);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: flex-end;
            z-index: 2000;
            animation: fadeIn 0.3s;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 10;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--gold);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
        }

        .modal-body {
            padding: 20px;
        }

        /* Form */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-input,
        .form-select {
            width: 100%;
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px 16px;
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(212, 175, 55, 0.4);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            margin-top: 12px;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 20px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: var(--gold);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Filters */
        .filters {
            padding: 16px 20px;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .filter-chip {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-chip.active {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
            border-color: var(--gold);
        }

        /* Loading & Empty */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-text {
            color: var(--text-secondary);
            font-size: 16px;
        }

        /* Autocomplete */
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
        }

        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .autocomplete-item:hover {
            background: var(--bg-card);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // API Configuration
        const API_URL = 'https://percy-untrundled-unseraphically.ngrok-free.dev';

        // Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // User Role (hardcoded for now - should come from backend)
        const USER_ROLE = 'admin'; // 'admin' | 'manager' | 'viewer'

        function App() {
            const [currentTab, setCurrentTab] = useState('home');
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [categories, setCategories] = useState([]);
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('all');
            const [showAddModal, setShowAddModal] = useState(false);
            const [showOrderModal, setShowOrderModal] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            const [orderingProduct, setOrderingProduct] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadProducts();
                loadOrders();
            }, []);

            const loadProducts = async () => {
                setLoading(true);
                try {
                    // Mock –¥–∞–Ω–Ω—ã–µ
                    const mockProducts = [
                        { id: 1, name: '–ü–æ–º–∏–¥–æ—Ä—ã', category: '–û–≤–æ—â–∏', price: 150, quantity: 25, unit: '–∫–≥' },
                        { id: 2, name: '–ö—É—Ä–∏—Ü–∞', category: '–ú—è—Å–æ', price: 350, quantity: 8, unit: '–∫–≥' },
                        { id: 3, name: '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å', category: '–û–≤–æ—â–∏', price: 80, quantity: 50, unit: '–∫–≥' },
                        { id: 4, name: '–ì–æ–≤—è–¥–∏–Ω–∞', category: '–ú—è—Å–æ', price: 550, quantity: 5, unit: '–∫–≥' },
                        { id: 5, name: '–õ—É–∫', category: '–û–≤–æ—â–∏', price: 60, quantity: 30, unit: '–∫–≥' },
                        { id: 6, name: '–Ø–π—Ü–∞', category: '–ú–æ–ª–æ—á–Ω–æ–µ', price: 5, quantity: 120, unit: '—à—Ç' },
                    ];
                    setProducts(mockProducts);
                    
                    const uniqueCategories = [...new Set(mockProducts.map(p => p.category))];
                    setCategories(uniqueCategories);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                } finally {
                    setLoading(false);
                }
            };

            const loadOrders = async () => {
                try {
                    // Mock –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–æ–≤
                    const mockOrders = [
                        {
                            id: 1,
                            number: 'ORD-001',
                            date: '2026-01-28',
                            status: 'new',
                            items: [
                                { product: '–ü–æ–º–∏–¥–æ—Ä—ã', quantity: 50, unit: '–∫–≥', price: 150 },
                                { product: '–õ—É–∫', quantity: 30, unit: '–∫–≥', price: 60 }
                            ],
                            total: 9300
                        },
                        {
                            id: 2,
                            number: 'ORD-002',
                            date: '2026-01-27',
                            status: 'processing',
                            items: [
                                { product: '–ö—É—Ä–∏—Ü–∞', quantity: 20, unit: '–∫–≥', price: 350 }
                            ],
                            total: 7000
                        }
                    ];
                    setOrders(mockOrders);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', error);
                }
            };

            const handleAddProduct = (productData) => {
                const newProduct = {
                    id: products.length + 1,
                    ...productData
                };
                setProducts([...products, newProduct]);
                setShowAddModal(false);
                tg.showPopup({ message: '–ü—Ä–æ–¥—É–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω!', buttons: [{ type: 'ok' }] });
            };

            const handleEditProduct = (productData) => {
                if (USER_ROLE === 'viewer') {
                    tg.showAlert('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ');
                    return;
                }
                setProducts(products.map(p => 
                    p.id === editingProduct.id ? { ...p, ...productData } : p
                ));
                setEditingProduct(null);
                tg.showPopup({ message: '–ü—Ä–æ–¥—É–∫—Ç –æ–±–Ω–æ–≤–ª—ë–Ω!', buttons: [{ type: 'ok' }] });
            };

            const handleDeleteProduct = (productId) => {
                if (USER_ROLE !== 'admin') {
                    tg.showAlert('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã');
                    return;
                }
                tg.showConfirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–¥—É–∫—Ç?', (confirmed) => {
                    if (confirmed) {
                        setProducts(products.filter(p => p.id !== productId));
                        setEditingProduct(null);
                    }
                });
            };

            const handleCreateOrder = (orderData) => {
                const newOrder = {
                    id: orders.length + 1,
                    number: `ORD-${String(orders.length + 1).padStart(3, '0')}`,
                    date: new Date().toISOString().split('T')[0],
                    status: 'new',
                    ...orderData
                };
                setOrders([newOrder, ...orders]);
                setShowOrderModal(false);
                setOrderingProduct(null);
                tg.showPopup({ message: '–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω!', buttons: [{ type: 'ok' }] });
            };

            const filteredProducts = products.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                                    product.id.toString().includes(searchQuery);
                const matchesCategory = selectedCategory === 'all' || product.category === selectedCategory;
                return matchesSearch && matchesCategory;
            });

            const lowStockProducts = products.filter(p => p.quantity < 10);

            const stats = {
                total: products.length,
                categories: categories.length,
                totalValue: products.reduce((sum, p) => sum + (p.price * p.quantity), 0),
                lowStock: lowStockProducts.length
            };

            const getStatusText = (status) => {
                const statusMap = {
                    'new': '–ù–æ–≤—ã–π',
                    'processing': '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ',
                    'delivered': '–î–æ—Å—Ç–∞–≤–ª–µ–Ω',
                    'paid': '–û–ø–ª–∞—á–µ–Ω'
                };
                return statusMap[status] || status;
            };

            return (
                <>
                    {/* Header */}
                    <div className="header">
                        <div className="header-top">
                            <div className="header-title">
                                {currentTab === 'home' && 'üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é'}
                                {currentTab === 'warehouse' && 'üì¶ –°–∫–ª–∞–¥'}
                                {currentTab === 'orders' && 'üõí –ó–∞–∫—É–ø–∫–∏'}
                            </div>
                            <div className="notification-icon" onClick={() => tg.showAlert(`–ù–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫: ${stats.lowStock} —à—Ç.`)}>
                                üîî
                                {stats.lowStock > 0 && (
                                    <span className="notification-badge">{stats.lowStock}</span>
                                )}
                            </div>
                        </div>
                        <div className="search-container">
                            <div className="search-wrapper">
                                <span className="search-icon">üîç</span>
                                <input
                                    type="text"
                                    className="search-input"
                                    placeholder="–ü–æ–∏—Å–∫..."
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                />
                            </div>
                        </div>
                    </div>

                    {/* Home Cards */}
                    {currentTab === 'home' && (
                        <div className="home-container">
                            <div className="cards-grid">
                                <div className="home-card gold-gradient" onClick={() => setCurrentTab('warehouse')}>
                                    <div className="home-card-icon">üì¶</div>
                                    <div>
                                        <div className="home-card-title">–°–∫–ª–∞–¥</div>
                                        <div className="home-card-subtitle">{stats.total} –ø—Ä–æ–¥—É–∫—Ç–æ–≤</div>
                                    </div>
                                </div>
                                <div className="home-card black-gold" onClick={() => setCurrentTab('orders')}>
                                    <div className="home-card-icon">üõí</div>
                                    <div>
                                        <div className="home-card-title">–ó–∞–∫—É–ø–∫–∏</div>
                                        <div className="home-card-subtitle">{orders.length} –∑–∞–∫–∞–∑–æ–≤</div>
                                    </div>
                                </div>
                                <div className="home-card gold-gradient" onClick={() => tg.showAlert('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')}>
                                    <div className="home-card-icon">üìä</div>
                                    <div>
                                        <div className="home-card-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                                        <div className="home-card-subtitle">–û—Ç—á—ë—Ç—ã –∏ –≥—Ä–∞—Ñ–∏–∫–∏</div>
                                    </div>
                                </div>
                                {USER_ROLE === 'admin' && (
                                    <div className="home-card black-gold" onClick={() => tg.showAlert('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')}>
                                        <div className="home-card-icon">üë•</div>
                                        <div>
                                            <div className="home-card-title">–ö–æ–º–∞–Ω–¥–∞</div>
                                            <div className="home-card-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Warehouse */}
                    {currentTab === 'warehouse' && (
                        <>
                            <div className="filters">
                                <div
                                    className={`filter-chip ${selectedCategory === 'all' ? 'active' : ''}`}
                                    onClick={() => setSelectedCategory('all')}
                                >
                                    –í—Å–µ
                                </div>
                                {categories.map(cat => (
                                    <div
                                        key={cat}
                                        className={`filter-chip ${selectedCategory === cat ? 'active' : ''}`}
                                        onClick={() => setSelectedCategory(cat)}
                                    >
                                        {cat}
                                    </div>
                                ))}
                            </div>
                            <div className="products-container">
                                {loading ? (
                                    <div className="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                                ) : filteredProducts.length === 0 ? (
                                    <div className="empty-state">
                                        <div className="empty-icon">üì≠</div>
                                        <div className="empty-text">
                                            {searchQuery ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : '–ù–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤'}
                                        </div>
                                    </div>
                                ) : (
                                    filteredProducts.map(product => (
                                        <div
                                            key={product.id}
                                            className={`product-card ${product.quantity < 10 ? 'low-stock' : ''}`}
                                        >
                                            <div className="product-header">
                                                <div>
                                                    <div className="product-name">{product.name}</div>
                                                    <div className="product-id">ID: {product.id}</div>
                                                </div>
                                                <div className="product-category">{product.category}</div>
                                            </div>
                                            <div className="product-details">
                                                <div className="product-detail">
                                                    <div className="detail-label">–¶–µ–Ω–∞</div>
                                                    <div className="detail-value">{product.price} ‚Ç¨</div>
                                                </div>
                                                <div className="product-detail">
                                                    <div className="detail-label">–û—Å—Ç–∞—Ç–æ–∫</div>
                                                    <div className={`detail-value ${product.quantity < 10 ? 'low' : ''}`}>
                                                        {product.quantity} {product.unit}
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="product-actions">
                                                <button className="btn-action btn-order" onClick={() => {
                                                    setOrderingProduct(product);
                                                    setShowOrderModal(true);
                                                }}>
                                                    üõí –ó–∞–∫–∞–∑–∞—Ç—å
                                                </button>
                                                {USER_ROLE !== 'viewer' && (
                                                    <button className="btn-action btn-edit" onClick={() => setEditingProduct(product)}>
                                                        ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                            {USER_ROLE !== 'viewer' && (
                                <button className="fab" onClick={() => setShowAddModal(true)}>+</button>
                            )}
                        </>
                    )}

                    {/* Orders */}
                    {currentTab === 'orders' && (
                        <>
                            <div className="orders-container">
                                {orders.length === 0 ? (
                                    <div className="empty-state">
                                        <div className="empty-icon">üõí</div>
                                        <div className="empty-text">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>
                                    </div>
                                ) : (
                                    orders.map(order => (
                                        <div key={order.id} className="order-card">
                                            <div className="order-header">
                                                <div className="order-number">#{order.number}</div>
                                                <div className={`order-status ${order.status}`}>
                                                    {getStatusText(order.status)}
                                                </div>
                                            </div>
                                            <div style={{fontSize: '12px', color: 'var(--text-secondary)', marginBottom: '12px'}}>
                                                {new Date(order.date).toLocaleDateString('ru-RU')}
                                            </div>
                                            <div className="order-items">
                                                {order.items.map((item, idx) => (
                                                    <div key={idx} className="order-item">
                                                        <span>{item.product} √ó {item.quantity} {item.unit}</span>
                                                        <span>{(item.quantity * item.price).toFixed(2)} ‚Ç¨</span>
                                                    </div>
                                                ))}
                                            </div>
                                            <div className="order-total">
                                                <span>–ò—Ç–æ–≥–æ:</span>
                                                <span>{order.total.toFixed(2)} ‚Ç¨</span>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </>
                    )}

                    {/* Bottom Navigation */}
                    <div className="bottom-nav">
                        <button
                            className={`nav-item ${currentTab === 'warehouse' ? 'active' : ''}`}
                            onClick={() => setCurrentTab('warehouse')}
                        >
                            <div className="nav-icon">üì¶</div>
                            <div className="nav-label">–°–∫–ª–∞–¥</div>
                        </button>
                        <button
                            className={`nav-item ${currentTab === 'orders' ? 'active' : ''}`}
                            onClick={() => setCurrentTab('orders')}
                        >
                            <div className="nav-icon">üõí</div>
                            <div className="nav-label">–ó–∞–∫—É–ø–∫–∏</div>
                        </button>
                        <button
                            className={`nav-item ${currentTab === 'home' ? 'active' : ''}`}
                            onClick={() => setCurrentTab('home')}
                        >
                            <div className="nav-icon">üè†</div>
                            <div className="nav-label">–ì–ª–∞–≤–Ω–æ–µ</div>
                        </button>
                    </div>

                    {/* Modals */}
                    {(showAddModal || editingProduct) && (
                        <ProductModal
                            product={editingProduct}
                            onSave={editingProduct ? handleEditProduct : handleAddProduct}
                            onClose={() => {
                                setShowAddModal(false);
                                setEditingProduct(null);
                            }}
                            onDelete={editingProduct ? () => handleDeleteProduct(editingProduct.id) : null}
                            categories={categories}
                            userRole={USER_ROLE}
                        />
                    )}

                    {showOrderModal && (
                        <OrderModal
                            product={orderingProduct}
                            onSave={handleCreateOrder}
                            onClose={() => {
                                setShowOrderModal(false);
                                setOrderingProduct(null);
                            }}
                        />
                    )}
                </>
            );
        }

        function ProductModal({ product, onSave, onClose, onDelete, categories, userRole }) {
            const [formData, setFormData] = useState(product || {
                name: '',
                category: '',
                price: '',
                quantity: '',
                unit: '–∫–≥'
            });
            const [showAutocomplete, setShowAutocomplete] = useState(false);
            const [categoryInput, setCategoryInput] = useState(product?.category || '');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!formData.name || !categoryInput || !formData.price || !formData.quantity) {
                    tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return;
                }
                onSave({...formData, category: categoryInput});
            };

            const filteredCategories = categories.filter(cat => 
                cat.toLowerCase().includes(categoryInput.toLowerCase())
            );

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <div className="modal-title">
                                {product ? '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç'}
                            </div>
                            <button className="modal-close" onClick={onClose}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit} className="modal-body">
                            <div className="form-group">
                                <label className="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</label>
                                <input
                                    type="text"
                                    className="form-input"
                                    value={formData.name}
                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–º–∏–¥–æ—Ä—ã"
                                />
                            </div>
                            <div className="form-group" style={{position: 'relative'}}>
                                <label className="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                <input
                                    type="text"
                                    className="form-input"
                                    value={categoryInput}
                                    onChange={(e) => {
                                        setCategoryInput(e.target.value);
                                        setShowAutocomplete(true);
                                    }}
                                    onFocus={() => setShowAutocomplete(true)}
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é"
                                />
                                {showAutocomplete && categoryInput && filteredCategories.length > 0 && (
                                    <div className="autocomplete-dropdown">
                                        {filteredCategories.map(cat => (
                                            <div
                                                key={cat}
                                                className="autocomplete-item"
                                                onClick={() => {
                                                    setCategoryInput(cat);
                                                    setShowAutocomplete(false);
                                                }}
                                            >
                                                {cat}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                            <div className="form-group">
                                <label className="form-label">–¶–µ–Ω–∞ (‚Ç¨)</label>
                                <input
                                    type="number"
                                    className="form-input"
                                    value={formData.price}
                                    onChange={(e) => setFormData({...formData, price: e.target.value})}
                                    placeholder="150"
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                                <div style={{display: 'flex', gap: '12px'}}>
                                    <input
                                        type="number"
                                        className="form-input"
                                        style={{flex: 2}}
                                        value={formData.quantity}
                                        onChange={(e) => setFormData({...formData, quantity: e.target.value})}
                                        placeholder="25"
                                    />
                                    <select
                                        className="form-select"
                                        style={{flex: 1}}
                                        value={formData.unit || '–∫–≥'}
                                        onChange={(e) => setFormData({...formData, unit: e.target.value})}
                                    >
                                        <option value="–∫–≥">–∫–≥</option>
                                        <option value="—à—Ç">—à—Ç</option>
                                        <option value="–ª">–ª</option>
                                        <option value="–≥">–≥</option>
                                        <option value="–º–ª">–º–ª</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" className="btn btn-primary">
                                {product ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è' : '–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç'}
                            </button>
                            {product && onDelete && userRole === 'admin' && (
                                <button type="button" className="btn btn-danger" onClick={onDelete}>
                                    üóë –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç
                                </button>
                            )}
                        </form>
                    </div>
                </div>
            );
        }

        function OrderModal({ product, onSave, onClose }) {
            const [formData, setFormData] = useState({
                items: product ? [{
                    product: product.name,
                    quantity: '',
                    unit: product.unit,
                    price: product.price
                }] : [{
                    product: '',
                    quantity: '',
                    unit: '–∫–≥',
                    price: ''
                }],
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                const total = formData.items.reduce((sum, item) => 
                    sum + (parseFloat(item.quantity) * parseFloat(item.price)), 0
                );
                onSave({
                    items: formData.items,
                    total: total
                });
            };

            const addItem = () => {
                setFormData({
                    ...formData,
                    items: [...formData.items, { product: '', quantity: '', unit: '–∫–≥', price: '' }]
                });
            };

            const removeItem = (index) => {
                const newItems = formData.items.filter((_, i) => i !== index);
                setFormData({...formData, items: newItems});
            };

            const updateItem = (index, field, value) => {
                const newItems = [...formData.items];
                newItems[index][field] = value;
                setFormData({...formData, items: newItems});
            };

            const total = formData.items.reduce((sum, item) => 
                sum + (parseFloat(item.quantity || 0) * parseFloat(item.price || 0)), 0
            );

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <div className="modal-title">üõí –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</div>
                            <button className="modal-close" onClick={onClose}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit} className="modal-body">
                            {formData.items.map((item, index) => (
                                <div key={index} style={{marginBottom: '20px', padding: '16px', background: 'var(--bg-main)', borderRadius: '12px'}}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '12px'}}>
                                        <span style={{fontWeight: 600}}>–¢–æ–≤–∞—Ä {index + 1}</span>
                                        {formData.items.length > 1 && (
                                            <button type="button" onClick={() => removeItem(index)} style={{background: 'none', border: 'none', color: 'var(--danger)', cursor: 'pointer'}}>
                                                ‚úï
                                            </button>
                                        )}
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">–ü—Ä–æ–¥—É–∫—Ç</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={item.product}
                                            onChange={(e) => updateItem(index, 'product', e.target.value)}
                                            placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞"
                                            disabled={product}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                                        <div style={{display: 'flex', gap: '12px'}}>
                                            <input
                                                type="number"
                                                className="form-input"
                                                style={{flex: 2}}
                                                value={item.quantity}
                                                onChange={(e) => updateItem(index, 'quantity', e.target.value)}
                                                placeholder="0"
                                            />
                                            <select
                                                className="form-select"
                                                style={{flex: 1}}
                                                value={item.unit}
                                                onChange={(e) => updateItem(index, 'unit', e.target.value)}
                                            >
                                                <option value="–∫–≥">–∫–≥</option>
                                                <option value="—à—Ç">—à—Ç</option>
                                                <option value="–ª">–ª</option>
                                                <option value="–≥">–≥</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">–¶–µ–Ω–∞ (‚Ç¨)</label>
                                        <input
                                            type="number"
                                            className="form-input"
                                            value={item.price}
                                            onChange={(e) => updateItem(index, 'price', e.target.value)}
                                            placeholder="0"
                                            disabled={product}
                                        />
                                    </div>
                                    {item.quantity && item.price && (
                                        <div style={{textAlign: 'right', color: 'var(--gold)', fontWeight: 600}}>
                                            –°—É–º–º–∞: {(item.quantity * item.price).toFixed(2)} ‚Ç¨
                                        </div>
                                    )}
                                </div>
                            ))}
                            
                            {!product && (
                                <button type="button" onClick={addItem} style={{width: '100%', padding: '12px', background: 'var(--bg-main)', border: '1px dashed var(--border)', borderRadius: '12px', color: 'var(--text-primary)', cursor: 'pointer', marginBottom: '20px'}}>
                                    + –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                                </button>
                            )}

                            <div style={{padding: '16px', background: 'var(--bg-main)', borderRadius: '12px', marginBottom: '20px'}}>
                                <div style={{display: 'flex', justifyContent: 'space-between', fontSize: '18px', fontWeight: 700, color: 'var(--gold)'}}>
                                    <span>–ò—Ç–æ–≥–æ:</span>
                                    <span>{total.toFixed(2)} ‚Ç¨</span>
                                </div>
                            </div>

                            <button type="submit" className="btn btn-primary">
                                –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
