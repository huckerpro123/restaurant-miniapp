<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --black: #000000;
            --gold: #D4AF37;
            --gold-dark: #B8941F;
            --gold-light: #F5E6C8;
            --bg-main: #0A0A0A;
            --bg-card: #1A1A1A;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0A0;
            --border: #2A2A2A;
            --success: #4CAF50;
            --danger: #F44336;
            --warning: #FF9800;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        #root {
            min-height: 100vh;
            padding-bottom: 70px;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            background: var(--bg-main);
            border-bottom: 1px solid var(--border);
            padding: 16px 20px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-title {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Search */
        .search-container {
            padding: 16px 20px;
        }

        .search-input {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px 16px;
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        /* Product Cards */
        .products-container {
            padding: 0 20px 20px;
        }

        .product-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .product-card:hover {
            border-color: var(--gold);
            transform: translateY(-2px);
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .product-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .product-id {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .product-category {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .product-details {
            display: flex;
            gap: 20px;
            margin-top: 12px;
        }

        .product-detail {
            flex: 1;
        }

        .detail-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--gold);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: none;
        }

        .nav-item.active {
            color: var(--gold);
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }

        /* Add Button */
        .fab {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--black);
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
            transition: all 0.3s;
            border: none;
            z-index: 999;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(212, 175, 55, 0.6);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: flex-end;
            z-index: 2000;
            animation: fadeIn 0.3s;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 10;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--gold);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
        }

        .modal-body {
            padding: 20px;
        }

        /* Form */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-input,
        .form-select {
            width: 100%;
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px 16px;
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(212, 175, 55, 0.4);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            margin-top: 12px;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 20px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Categories */
        .category-list {
            padding: 20px;
        }

        .category-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-name {
            font-size: 16px;
            font-weight: 600;
        }

        .category-count {
            background: var(--gold);
            color: var(--black);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-text {
            color: var(--text-secondary);
            font-size: 16px;
        }

        /* Filters */
        .filters {
            padding: 16px 20px;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .filter-chip {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-chip.active {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
            border-color: var(--gold);
        }

        .filter-chip:hover {
            border-color: var(--gold);
        }
    
        /* NEW: Low Stock Modal */
        .low-stock-list {
            padding: 0;
        }

        .low-stock-item {
            background: var(--bg-main);
            border: 1px solid var(--danger);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .low-stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .low-stock-name {
            font-size: 16px;
            font-weight: 600;
        }

        .low-stock-badge {
            background: var(--danger);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .low-stock-details {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .stat-card.clickable {
            cursor: pointer;
        }

        .stat-card.clickable:hover {
            border-color: var(--gold);
            transform: scale(1.02);
        }

        .chart-container {
            padding: 20px;
            background: var(--bg-card);
            border-radius: 16px;
            margin: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gold);
            margin-bottom: 16px;
            text-align: center;
        }

        .export-buttons {
            display: flex;
            gap: 12px;
            padding: 0 20px 20px;
        }

        .export-btn {
            flex: 1;
            padding: 14px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .export-btn:hover {
            border-color: var(--gold);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // API Configuration
        const API_URL = 'https://percy-untrundled-unseraphically.ngrok-free.dev'; // –ó–∞–º–µ–Ω–∏ –Ω–∞ URL —Ç–≤–æ–µ–≥–æ backend

        // Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        function App() {
            const [currentTab, setCurrentTab] = useState('products');
            const [products, setProducts] = useState([]);
            const [categories, setCategories] = useState([]);
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('all');
            const [showAddModal, setShowAddModal] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            const [showLowStockModal, setShowLowStockModal] = useState(false);
            const [loading, setLoading] = useState(true);
            const observerRef = useRef();

            // Load products from Google Sheets
            useEffect(() => {
                loadProducts();
            }, [])

            // NEW: Chart initialization
            useEffect(() => {
                if (currentTab === 'stats' && products.length > 0) {
                    setTimeout(() => {
                        const canvas = document.getElementById('categoryChart');
                        if (!canvas) return;
                        
                        const ctx = canvas.getContext('2d');
                        
                        if (window.categoryChartInstance) {
                            window.categoryChartInstance.destroy();
                        }
                        
                        const categoryData = categories.map(cat => 
                            products.filter(p => p.category === cat).length
                        );
                        
                        window.categoryChartInstance = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: categories,
                                datasets: [{
                                    data: categoryData,
                                    backgroundColor: [
                                        'rgba(212, 175, 55, 0.8)',
                                        'rgba(184, 148, 31, 0.8)',
                                        'rgba(245, 230, 200, 0.8)',
                                        'rgba(255, 215, 0, 0.8)'
                                    ],
                                    borderColor: 'rgba(212, 175, 55, 1)',
                                    borderWidth: 2
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: { color: '#FFFFFF' }
                                    }
                                }
                            }
                        });
                    }, 100);
                }
            }, [currentTab, products, categories]);;

            const loadProducts = async () => {
                setLoading(true);
                try {
                    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Ç–≤–æ–µ–º—É backend, –∫–æ—Ç–æ—Ä—ã–π —á–∏—Ç–∞–µ—Ç Google Sheets
                    // –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º mock –¥–∞–Ω–Ω—ã–µ
                    const mockProducts = [
                        { id: 1, name: '–ü–æ–º–∏–¥–æ—Ä—ã', category: '–û–≤–æ—â–∏', price: 150, quantity: 25 },
                        { id: 2, name: '–ö—É—Ä–∏—Ü–∞', category: '–ú—è—Å–æ', price: 350, quantity: 10 },
                        { id: 3, name: '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å', category: '–û–≤–æ—â–∏', price: 80, quantity: 50 },
                        { id: 4, name: '–ì–æ–≤—è–¥–∏–Ω–∞', category: '–ú—è—Å–æ', price: 550, quantity: 8 },
                        { id: 5, name: '–õ—É–∫', category: '–û–≤–æ—â–∏', price: 60, quantity: 30 },
                    ];
                    setProducts(mockProducts);
                    
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    const uniqueCategories = [...new Set(mockProducts.map(p => p.category))];
                    setCategories(uniqueCategories);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                    tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                } finally {
                    setLoading(false);
                }
            };

            // NEW: Export to Excel
            const exportToExcel = () => {
                const ws = XLSX.utils.json_to_sheet(products.map(p => ({
                    'ID': p.id,
                    '–ù–∞–∑–≤–∞–Ω–∏–µ': p.name,
                    '–ö–∞—Ç–µ–≥–æ—Ä–∏—è': p.category,
                    '–¶–µ–Ω–∞ (‚Ç¨)': p.price,
                    '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–∫–≥)': p.quantity,
                    '–í—Å–µ–≥–æ (‚Ç¨)': (p.price * p.quantity).toFixed(2)
                })));
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, '–ü—Ä–æ–¥—É–∫—Ç—ã');
                const date = new Date().toISOString().split('T')[0];
                XLSX.writeFile(wb, `products_${date}.xlsx`);
                tg.showPopup({ message: 'Excel —Ñ–∞–π–ª —Å–∫–∞—á–∞–Ω!', buttons: [{ type: 'ok' }] });
            };

            // NEW: Export to PDF
            const exportToPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(16);
                doc.text('–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º', 20, 20);
                
                const date = new Date().toLocaleDateString('ru-RU');
                doc.setFontSize(10);
                doc.text(`–î–∞—Ç–∞: ${date}`, 20, 30);
                
                let y = 45;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(9);
                
                products.forEach(p => {
                    if (y > 270) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(`${p.id}. ${p.name} - ${p.category} - ${p.price}‚Ç¨ - ${p.quantity}kg`, 20, y);
                    y += 8;
                });
                
                doc.save(`products_${new Date().toISOString().split('T')[0]}.pdf`);
                tg.showPopup({ message: 'PDF —Ñ–∞–π–ª —Å–∫–∞—á–∞–Ω!', buttons: [{ type: 'ok' }] });
            };

            const handleAddProduct = (productData) => {
                // –ó–¥–µ—Å—å –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ backend
                const newProduct = {
                    id: products.length + 1,
                    ...productData
                };
                setProducts([...products, newProduct]);
                setShowAddModal(false);
                tg.showPopup({
                    message: '–ü—Ä–æ–¥—É–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω!',
                    buttons: [{ type: 'ok' }]
                });
            };

            const handleEditProduct = (productData) => {
                setProducts(products.map(p => 
                    p.id === editingProduct.id ? { ...p, ...productData } : p
                ));
                setEditingProduct(null);
                tg.showPopup({
                    message: '–ü—Ä–æ–¥—É–∫—Ç –æ–±–Ω–æ–≤–ª—ë–Ω!',
                    buttons: [{ type: 'ok' }]
                });
            };

            const handleDeleteProduct = (productId) => {
                tg.showConfirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–¥—É–∫—Ç?', (confirmed) => {
                    if (confirmed) {
                        setProducts(products.filter(p => p.id !== productId));
                        setEditingProduct(null);
                    }
                });
            };

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤
            
            // NEW: Low stock products
            const lowStockProducts = products.filter(p => p.quantity < 10);

            const filteredProducts = products.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                                    product.id.toString().includes(searchQuery);
                const matchesCategory = selectedCategory === 'all' || product.category === selectedCategory;
                return matchesSearch && matchesCategory;
            });

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const stats = {
                total: products.length,
                categories: categories.length,
                totalValue: products.reduce((sum, p) => sum + (p.price * p.quantity), 0),
                lowStock: products.filter(p => p.quantity < 10).length
            };

            return (
                <>
                    {currentTab === 'products' && (
                        <>
                            <div className="header">
                                <div className="header-title">üì¶ –ü—Ä–æ–¥—É–∫—Ç—ã</div>
                            </div>
                            <div className="search-container">
                                <input
                                    type="text"
                                    className="search-input"
                                    placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ ID –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—é..."
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                />
                            </div>
                            <div className="filters">
                                <div
                                    className={`filter-chip ${selectedCategory === 'all' ? 'active' : ''}`}
                                    onClick={() => setSelectedCategory('all')}
                                >
                                    –í—Å–µ
                                </div>
                                {categories.map(cat => (
                                    <div
                                        key={cat}
                                        className={`filter-chip ${selectedCategory === cat ? 'active' : ''}`}
                                        onClick={() => setSelectedCategory(cat)}
                                    >
                                        {cat}
                                    </div>
                                ))}
                            </div>
                            <div className="products-container">
                                {loading ? (
                                    <div className="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                                ) : filteredProducts.length === 0 ? (
                                    <div className="empty-state">
                                        <div className="empty-icon">üì≠</div>
                                        <div className="empty-text">
                                            {searchQuery ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : '–ù–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤'}
                                        </div>
                                    </div>
                                ) : (
                                    filteredProducts.map(product => (
                                        <div
                                            key={product.id}
                                            className="product-card"
                                            onClick={() => setEditingProduct(product)}
                                        >
                                            <div className="product-header">
                                                <div>
                                                    <div className="product-name">{product.name}</div>
                                                    <div className="product-id">ID: {product.id}</div>
                                                </div>
                                                <div className="product-category">{product.category}</div>
                                            </div>
                                            <div className="product-details">
                                                <div className="product-detail">
                                                    <div className="detail-label">–¶–µ–Ω–∞</div>
                                                    <div className="detail-value">{product.price} ‚Ç¨</div>
                                                </div>
                                                <div className="product-detail">
                                                    <div className="detail-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
                                                    <div className="detail-value">{product.quantity} –∫–≥</div>
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                            <button className="fab" onClick={() => setShowAddModal(true)}>+</button>
                        </>
                    )}

                    {currentTab === 'categories' && (
                        <>
                            <div className="header">
                                <div className="header-title">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
                            </div>
                            <div className="category-list">
                                {categories.map(category => {
                                    const count = products.filter(p => p.category === category).length;
                                    return (
                                        <div key={category} className="category-item">
                                            <div className="category-name">{category}</div>
                                            <div className="category-count">{count}</div>
                                        </div>
                                    );
                                })}
                            </div>
                        </>
                    )}

                    {currentTab === 'stats' && (
                        <>
                            <div className="header">
                                <div className="header-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                            </div>
                            <div className="stats-grid">
                                <div className="stat-card">
                                    <div className="stat-value">{stats.total}</div>
                                    <div className="stat-label">–í—Å–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</div>
                                </div>
                                <div className="stat-card">
                                    <div className="stat-value">{stats.categories}</div>
                                    <div className="stat-label">–ö–∞—Ç–µ–≥–æ—Ä–∏–π</div>
                                </div>
                                <div className="stat-card">
                                    <div className="stat-value">{stats.totalValue.toLocaleString()}</div>
                                    <div className="stat-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å ‚Ç¨</div>
                                </div>
                                <div className="stat-card">
                                    <div className="stat-value" style={{color: stats.lowStock > 0 ? 'var(--danger)' : 'var(--success)'}}>
                                        {stats.lowStock}
                                    </div>
                                    <div className="stat-label">–ù–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫</div>
                                </div>
                            </div>
                        </>
                    )}

                    {/* Bottom Navigation */}
                    <div className="bottom-nav">
                        <button
                            className={`nav-item ${currentTab === 'products' ? 'active' : ''}`}
                            onClick={() => setCurrentTab('products')}
                        >
                            <div className="nav-icon">üì¶</div>
                            <div className="nav-label">–ü—Ä–æ–¥—É–∫—Ç—ã</div>
                        </button>
                        <button
                            className={`nav-item ${currentTab === 'categories' ? 'active' : ''}`}
                            onClick={() => setCurrentTab('categories')}
                        >
                            <div className="nav-icon">üìÇ</div>
                            <div className="nav-label">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
                        </button>
                        <button
                            className={`nav-item ${currentTab === 'stats' ? 'active' : ''}`}
                            onClick={() => setCurrentTab('stats')}
                        >
                            <div className="nav-icon">üìä</div>
                            <div className="nav-label">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                        </button>
                    </div>

                    {/* Add/Edit Modal */}
                    {(showAddModal || editingProduct) && (
                        <ProductModal
                            product={editingProduct}
                            onSave={editingProduct ? handleEditProduct : handleAddProduct}
                            onClose={() => {
                                setShowAddModal(false);
                                setEditingProduct(null);
                            }}
                            onDelete={editingProduct ? () => handleDeleteProduct(editingProduct.id) : null}
                            categories={categories}
                        />
                    )}
                

                    {showLowStockModal && (
                        <div className="modal-overlay" onClick={() => setShowLowStockModal(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <div className="modal-title">‚ö†Ô∏è –ù–∏–∑–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ (&lt; 10 –∫–≥)</div>
                                    <button className="modal-close" onClick={() => setShowLowStockModal(false)}>√ó</button>
                                </div>
                                <div className="modal-body">
                                    {lowStockProducts.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-icon">‚úÖ</div>
                                            <div className="empty-text">–í—Å–µ –æ—Å—Ç–∞—Ç–∫–∏ –≤ –Ω–æ—Ä–º–µ!</div>
                                        </div>
                                    ) : (
                                        <div className="low-stock-list">
                                            {lowStockProducts.map(product => (
                                                <div key={product.id} className="low-stock-item">
                                                    <div className="low-stock-header">
                                                        <div className="low-stock-name">{product.name}</div>
                                                        <div className="low-stock-badge">
                                                            {product.quantity} –∫–≥
                                                        </div>
                                                    </div>
                                                    <div className="low-stock-details">
                                                        <span>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.category}</span>
                                                        <span>–¶–µ–Ω–∞: {product.price} ‚Ç¨</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </>
            );
        }

        function ProductModal({ product, onSave, onClose, onDelete, categories }) {
            const [formData, setFormData] = useState(product || {
                name: '',
                category: '',
                price: '',
                quantity: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!formData.name || !formData.category || !formData.price || !formData.quantity) {
                    tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return;
                }
                onSave(formData);
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <div className="modal-title">
                                {product ? '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç'}
                            </div>
                            <button className="modal-close" onClick={onClose}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit} className="modal-body">
                            <div className="form-group">
                                <label className="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</label>
                                <input
                                    type="text"
                                    className="form-input"
                                    value={formData.name}
                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–º–∏–¥–æ—Ä—ã"
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                <select
                                    className="form-select"
                                    value={formData.category}
                                    onChange={(e) => setFormData({...formData, category: e.target.value})}
                                >
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                    {categories.map(cat => (
                                        <option key={cat} value={cat}>{cat}</option>
                                    ))}
                                    <option value="__new__">+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é</option>
                                </select>
                            </div>
                            <div className="form-group">
                                <label className="form-label">–¶–µ–Ω–∞ (‚Ç¨)</label>
                                <input
                                    type="number"
                                    className="form-input"
                                    value={formData.price}
                                    onChange={(e) => setFormData({...formData, price: e.target.value})}
                                    placeholder="150"
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–∫–≥)</label>
                                <input
                                    type="number"
                                    className="form-input"
                                    value={formData.quantity}
                                    onChange={(e) => setFormData({...formData, quantity: e.target.value})}
                                    placeholder="25"
                                />
                            </div>
                            <button type="submit" className="btn btn-primary">
                                {product ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è' : '–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç'}
                            </button>
                            {product && onDelete && (
                                <button type="button" className="btn btn-danger" onClick={onDelete}>
                                    üóë –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç
                                </button>
                            )}
                        </form>
                    </div>
                </div>
            );
        }

        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
