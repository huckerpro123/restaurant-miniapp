<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GRAND Restaurant - Система управления</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --black: #0A0A0A;
            --gold: #D4AF37;
            --gold-dark: #B8941F;
            --gold-light: #F5E6C8;
            --bg-main: #0A0A0A;
            --bg-card: #1A1A1A;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0A0;
            --border: #2A2A2A;
            --success: #4CAF50;
            --danger: #F44336;
            --warning: #FF9800;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        #root {
            min-height: 100vh;
            padding-bottom: 70px;
        }

        /* Header with Logo */
        .header {
            position: sticky;
            top: 0;
            background: var(--bg-main);
            padding: 16px 20px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
        }

        .header-top {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 12px;
        }

        .logo {
            font-size: 24px;
            font-weight: 900;
            letter-spacing: 2px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-subtitle {
            font-size: 8px;
            letter-spacing: 4px;
            color: var(--text-secondary);
            text-align: center;
            margin-top: -4px;
        }

        .search-wrapper {
            flex: 1;
            position: relative;
        }

        .search-input {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 16px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.1);
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 200;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid var(--border);
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover {
            background: var(--bg-main);
            color: var(--gold);
        }

        .autocomplete-highlight {
            color: var(--gold);
            font-weight: 600;
        }

        /* Home Menu Cards */
        .home-container {
            padding: 20px;
        }

        .menu-grid {
            display: grid;
            gap: 16px;
        }

        .menu-grid.three-buttons {
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: auto auto;
        }

        .menu-grid.three-buttons .menu-card:last-child {
            grid-column: 1 / -1;
        }

        .menu-grid.four-buttons {
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: auto auto;
        }

        .menu-card {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            border: none;
            border-radius: 16px;
            padding: 32px 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(212, 175, 55, 0.4);
        }

        .menu-card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--black);
        }

        /* Warehouse Table (Google Sheets style) */
        .warehouse-container {
            padding: 0 20px 20px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            padding: 16px 20px 0;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--gold);
            border-bottom-color: var(--gold);
        }

        .table-wrapper {
            overflow-x: auto;
            margin-top: 16px;
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: var(--bg-card);
            border-radius: 8px;
            overflow: hidden;
        }

        .data-table thead {
            background: var(--bg-main);
        }

        .data-table th {
            padding: 14px 12px;
            text-align: left;
            font-size: 12px;
            font-weight: 700;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border);
            white-space: nowrap;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table tr:hover td {
            background: rgba(212, 175, 55, 0.05);
        }

        .data-table td.editable:hover {
            background: rgba(212, 175, 55, 0.1);
            outline: 1px solid var(--gold);
        }

        .data-table td.editing {
            padding: 0;
        }

        .cell-input {
            width: 100%;
            background: var(--bg-main);
            border: 2px solid var(--gold);
            padding: 12px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .cell-input:focus {
            outline: none;
        }

        .category-badge {
            display: inline-block;
            padding: 4px 12px;
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .quantity-cell {
            font-weight: 600;
            color: var(--gold);
        }

        .quantity-cell.low {
            color: var(--danger);
        }

        .id-cell {
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
        }

        /* Orders / Procurement */
        .orders-container {
            padding: 20px;
        }

        .forecast-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .forecast-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 16px;
        }

        .forecast-options {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .forecast-btn {
            flex: 1;
            padding: 10px;
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .forecast-btn.active {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
            border-color: var(--gold);
        }

        .forecast-result {
            padding: 16px;
            background: var(--bg-main);
            border-radius: 8px;
            border-left: 4px solid var(--gold);
        }

        .forecast-text {
            font-size: 14px;
            line-height: 1.6;
        }

        .forecast-highlight {
            color: var(--gold);
            font-weight: 700;
        }

        .low-stock-list {
            margin-top: 20px;
        }

        .low-stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .low-stock-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--danger);
        }

        .order-all-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .order-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
        }

        .low-stock-item {
            background: var(--bg-card);
            border: 1px solid var(--danger);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .low-stock-info {
            flex: 1;
        }

        .low-stock-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .low-stock-details {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .low-stock-quantity {
            background: var(--danger);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 700;
        }

        /* Bottom Navigation (no emoji) */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: none;
            font-size: 13px;
            font-weight: 600;
        }

        .nav-item.active {
            color: var(--gold);
        }

        /* FAB for Quick Order */
        .fab {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--black);
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
            transition: all 0.3s;
            border: none;
            z-index: 999;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(212, 175, 55, 0.6);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: flex-end;
            z-index: 2000;
            animation: fadeIn 0.3s;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 10;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--gold);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-input,
        .form-select {
            width: 100%;
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: var(--black);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            margin-top: 12px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-text {
            color: var(--text-secondary);
            font-size: 16px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // API Configuration
        const API_URL = 'https://percy-untrundled-unseraphically.ngrok-free.app';

        // Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // User Role
        const USER_ROLE = 'admin'; // 'admin' | 'manager' | 'viewer'

        function App() {
            const [currentTab, setCurrentTab] = useState('home');
            const [warehouseTab, setWarehouseTab] = useState('all');
            const [products, setProducts] = useState([]);
            const [categories, setCategories] = useState([]);
            const [searchQuery, setSearchQuery] = useState('');
            const [showAutocomplete, setShowAutocomplete] = useState(false);
            const [editingCell, setEditingCell] = useState(null);
            const [showQuickOrder, setShowQuickOrder] = useState(false);
            const [forecastDays, setForecastDays] = useState(3);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadProducts();
            }, []);

            const loadProducts = async () => {
                setLoading(true);
                try {
                    const mockProducts = [
                        { id: 1, name: 'Помидоры', category: 'Овощи', price: 150, quantity: 25, unit: 'кг', dailyUsage: 8 },
                        { id: 2, name: 'Курица', category: 'Мясо', price: 350, quantity: 8, unit: 'кг', dailyUsage: 5 },
                        { id: 3, name: 'Картофель', category: 'Овощи', price: 80, quantity: 50, unit: 'кг', dailyUsage: 12 },
                        { id: 4, name: 'Говядина', category: 'Мясо', price: 550, quantity: 5, unit: 'кг', dailyUsage: 3 },
                        { id: 5, name: 'Лук', category: 'Овощи', price: 60, quantity: 30, unit: 'кг', dailyUsage: 6 },
                        { id: 6, name: 'Яйца', category: 'Молочное', price: 5, quantity: 120, unit: 'шт', dailyUsage: 50 },
                        { id: 7, name: 'Молоко', category: 'Молочное', price: 80, quantity: 7, unit: 'л', dailyUsage: 4 },
                    ];
                    setProducts(mockProducts);
                    
                    const uniqueCategories = [...new Set(mockProducts.map(p => p.category))];
                    setCategories(uniqueCategories);
                } catch (error) {
                    console.error('Ошибка загрузки:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleCellEdit = (productId, field, value) => {
                setProducts(products.map(p => 
                    p.id === productId ? { ...p, [field]: value } : p
                ));
                setEditingCell(null);
            };

            const handleQuickOrder = () => {
                const lowStock = products.filter(p => p.quantity < 10);
                if (lowStock.length === 0) {
                    tg.showAlert('Нет продуктов с низкими остатками');
                    return;
                }
                setShowQuickOrder(true);
            };

            const handleOrderAll = () => {
                const lowStock = products.filter(p => p.quantity < 10);
                const totalCost = lowStock.reduce((sum, p) => sum + (p.price * (p.dailyUsage * forecastDays - p.quantity)), 0);
                tg.showConfirm(
                    `Заказать ${lowStock.length} позиций на сумму ${totalCost.toFixed(2)} €?`,
                    (confirmed) => {
                        if (confirmed) {
                            tg.showPopup({ message: 'Заказ создан!', buttons: [{ type: 'ok' }] });
                        }
                    }
                );
            };

            const filteredProducts = products.filter(product => {
                if (!searchQuery) return true;
                const query = searchQuery.toLowerCase();
                return product.name.toLowerCase().includes(query) ||
                       product.category.toLowerCase().includes(query) ||
                       product.id.toString().includes(query);
            });

            const autocompleteResults = searchQuery ? 
                filteredProducts.slice(0, 5).map(p => p.name) : [];

            const lowStockProducts = products.filter(p => p.quantity < 10);

            const displayProducts = warehouseTab === 'low' ? lowStockProducts : filteredProducts;

            const getForecast = () => {
                const results = lowStockProducts.map(p => {
                    const daysRemaining = Math.floor(p.quantity / p.dailyUsage);
                    const needToOrder = Math.max(0, (p.dailyUsage * forecastDays) - p.quantity);
                    return { ...p, daysRemaining, needToOrder };
                });
                return results;
            };

            const forecastResults = getForecast();

            const highlightMatch = (text, query) => {
                if (!query) return text;
                const index = text.toLowerCase().indexOf(query.toLowerCase());
                if (index === -1) return text;
                return (
                    <>
                        {text.substring(0, index)}
                        <span className="autocomplete-highlight">
                            {text.substring(index, index + query.length)}
                        </span>
                        {text.substring(index + query.length)}
                    </>
                );
            };

            return (
                <>
                    <div className="header">
                        <div className="header-top">
                            <div>
                                <div className="logo">GRAND</div>
                                <div className="logo-subtitle">RESTAURANT</div>
                            </div>
                            <div className="search-wrapper">
                                <input
                                    type="text"
                                    className="search-input"
                                    placeholder="Поиск..."
                                    value={searchQuery}
                                    onChange={(e) => {
                                        setSearchQuery(e.target.value);
                                        setShowAutocomplete(e.target.value.length > 0);
                                    }}
                                    onFocus={() => setShowAutocomplete(searchQuery.length > 0)}
                                    onBlur={() => setTimeout(() => setShowAutocomplete(false), 200)}
                                />
                                {showAutocomplete && autocompleteResults.length > 0 && (
                                    <div className="autocomplete-dropdown">
                                        {autocompleteResults.map((name, idx) => (
                                            <div
                                                key={idx}
                                                className="autocomplete-item"
                                                onClick={() => {
                                                    setSearchQuery(name);
                                                    setShowAutocomplete(false);
                                                }}
                                            >
                                                {highlightMatch(name, searchQuery)}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Home Menu */}
                    {currentTab === 'home' && (
                        <div className="home-container">
                            <div className={`menu-grid ${USER_ROLE === 'admin' ? 'four-buttons' : 'three-buttons'}`}>
                                <div className="menu-card" onClick={() => setCurrentTab('warehouse')}>
                                    <div className="menu-card-title">Склад</div>
                                </div>
                                <div className="menu-card" onClick={() => setCurrentTab('orders')}>
                                    <div className="menu-card-title">Закупки</div>
                                </div>
                                {USER_ROLE === 'admin' && (
                                    <div className="menu-card" onClick={() => tg.showAlert('Редактирование доступно в разделе Склад')}>
                                        <div className="menu-card-title">Редактировать</div>
                                    </div>
                                )}
                                <div className="menu-card" onClick={handleQuickOrder}>
                                    <div className="menu-card-title">Заказать</div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Warehouse */}
                    {currentTab === 'warehouse' && (
                        <>
                            <div className="tabs">
                                <button
                                    className={`tab ${warehouseTab === 'all' ? 'active' : ''}`}
                                    onClick={() => setWarehouseTab('all')}
                                >
                                    Все продукты
                                </button>
                                <button
                                    className={`tab ${warehouseTab === 'low' ? 'active' : ''}`}
                                    onClick={() => setWarehouseTab('low')}
                                >
                                    Низкие остатки ({lowStockProducts.length})
                                </button>
                            </div>
                            <div className="warehouse-container">
                                {loading ? (
                                    <div className="loading">Загрузка...</div>
                                ) : displayProducts.length === 0 ? (
                                    <div className="empty-state">
                                        <div className="empty-text">
                                            {warehouseTab === 'low' ? 'Нет продуктов с низкими остатками' : 'Нет продуктов'}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="table-wrapper">
                                        <table className="data-table">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Название</th>
                                                    <th>Категория</th>
                                                    <th>Цена (€)</th>
                                                    <th>Кол-во</th>
                                                    <th>Ед.</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {displayProducts.map(product => (
                                                    <tr key={product.id}>
                                                        <td className="id-cell">{product.id}</td>
                                                        <td
                                                            className={USER_ROLE !== 'viewer' ? 'editable' : ''}
                                                            onClick={() => USER_ROLE !== 'viewer' && setEditingCell({ id: product.id, field: 'name' })}
                                                        >
                                                            {editingCell?.id === product.id && editingCell?.field === 'name' ? (
                                                                <input
                                                                    className="cell-input"
                                                                    type="text"
                                                                    defaultValue={product.name}
                                                                    autoFocus
                                                                    onBlur={(e) => handleCellEdit(product.id, 'name', e.target.value)}
                                                                    onKeyDown={(e) => {
                                                                        if (e.key === 'Enter') {
                                                                            handleCellEdit(product.id, 'name', e.target.value);
                                                                        }
                                                                    }}
                                                                />
                                                            ) : (
                                                                product.name
                                                            )}
                                                        </td>
                                                        <td>
                                                            <span className="category-badge">{product.category}</span>
                                                        </td>
                                                        <td
                                                            className={USER_ROLE !== 'viewer' ? 'editable' : ''}
                                                            onClick={() => USER_ROLE !== 'viewer' && setEditingCell({ id: product.id, field: 'price' })}
                                                        >
                                                            {editingCell?.id === product.id && editingCell?.field === 'price' ? (
                                                                <input
                                                                    className="cell-input"
                                                                    type="number"
                                                                    defaultValue={product.price}
                                                                    autoFocus
                                                                    onBlur={(e) => handleCellEdit(product.id, 'price', parseFloat(e.target.value))}
                                                                    onKeyDown={(e) => {
                                                                        if (e.key === 'Enter') {
                                                                            handleCellEdit(product.id, 'price', parseFloat(e.target.value));
                                                                        }
                                                                    }}
                                                                />
                                                            ) : (
                                                                product.price
                                                            )}
                                                        </td>
                                                        <td
                                                            className={`quantity-cell ${product.quantity < 10 ? 'low' : ''} ${USER_ROLE !== 'viewer' ? 'editable' : ''}`}
                                                            onClick={() => USER_ROLE !== 'viewer' && setEditingCell({ id: product.id, field: 'quantity' })}
                                                        >
                                                            {editingCell?.id === product.id && editingCell?.field === 'quantity' ? (
                                                                <input
                                                                    className="cell-input"
                                                                    type="number"
                                                                    defaultValue={product.quantity}
                                                                    autoFocus
                                                                    onBlur={(e) => handleCellEdit(product.id, 'quantity', parseFloat(e.target.value))}
                                                                    onKeyDown={(e) => {
                                                                        if (e.key === 'Enter') {
                                                                            handleCellEdit(product.id, 'quantity', parseFloat(e.target.value));
                                                                        }
                                                                    }}
                                                                />
                                                            ) : (
                                                                product.quantity
                                                            )}
                                                        </td>
                                                        <td>{product.unit}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>
                        </>
                    )}

                    {/* Orders / Procurement */}
                    {currentTab === 'orders' && (
                        <div className="orders-container">
                            <div className="forecast-panel">
                                <div className="forecast-title">Прогноз остатков</div>
                                <div className="forecast-options">
                                    <button
                                        className={`forecast-btn ${forecastDays === 3 ? 'active' : ''}`}
                                        onClick={() => setForecastDays(3)}
                                    >
                                        3 дня
                                    </button>
                                    <button
                                        className={`forecast-btn ${forecastDays === 5 ? 'active' : ''}`}
                                        onClick={() => setForecastDays(5)}
                                    >
                                        5 дней
                                    </button>
                                    <button
                                        className={`forecast-btn ${forecastDays === 7 ? 'active' : ''}`}
                                        onClick={() => setForecastDays(7)}
                                    >
                                        7 дней
                                    </button>
                                </div>
                                <div className="forecast-result">
                                    <div className="forecast-text">
                                        На складе <span className="forecast-highlight">{lowStockProducts.length}</span> продуктов с низкими остатками.
                                        <br/>
                                        При текущем потреблении запасов хватит на{' '}
                                        <span className="forecast-highlight">
                                            {Math.min(...forecastResults.map(r => r.daysRemaining))} дней
                                        </span>.
                                        <br/>
                                        Для работы {forecastDays} дней необходимо заказать на сумму{' '}
                                        <span className="forecast-highlight">
                                            {forecastResults.reduce((sum, r) => sum + (r.needToOrder * r.price), 0).toFixed(2)} €
                                        </span>.
                                    </div>
                                </div>
                            </div>

                            <div className="low-stock-list">
                                <div className="low-stock-header">
                                    <div className="low-stock-title">Требуется заказать</div>
                                    {lowStockProducts.length > 0 && (
                                        <button className="order-all-btn" onClick={handleOrderAll}>
                                            Заказать всё
                                        </button>
                                    )}
                                </div>
                                {lowStockProducts.length === 0 ? (
                                    <div className="empty-state">
                                        <div className="empty-text">Все остатки в норме</div>
                                    </div>
                                ) : (
                                    forecastResults.map(item => (
                                        <div key={item.id} className="low-stock-item">
                                            <div className="low-stock-info">
                                                <div className="low-stock-name">{item.name}</div>
                                                <div className="low-stock-details">
                                                    {item.category} • Осталось на {item.daysRemaining} дней • Нужно заказать: {item.needToOrder} {item.unit}
                                                </div>
                                            </div>
                                            <div className="low-stock-quantity">
                                                {item.quantity} {item.unit}
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    )}

                    {/* Bottom Navigation */}
                    <div className="bottom-nav">
                        <button
                            className={`nav-item ${currentTab === 'warehouse' ? 'active' : ''}`}
                            onClick={() => setCurrentTab('warehouse')}
                        >
                            Склад
                        </button>
                        <button
                            className={`nav-item ${currentTab === 'orders' ? 'active' : ''}`}
                            onClick={() => setCurrentTab('orders')}
                        >
                            Закупки
                        </button>
                        <button
                            className={`nav-item ${currentTab === 'home' ? 'active' : ''}`}
                            onClick={() => setCurrentTab('home')}
                        >
                            Главное
                        </button>
                    </div>

                    {/* FAB */}
                    <button className="fab" onClick={handleQuickOrder}>+</button>

                    {/* Quick Order Modal */}
                    {showQuickOrder && (
                        <div className="modal-overlay" onClick={() => setShowQuickOrder(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <div className="modal-title">Быстрый заказ</div>
                                    <button className="modal-close" onClick={() => setShowQuickOrder(false)}>×</button>
                                </div>
                                <div className="modal-body">
                                    {lowStockProducts.length === 0 ? (
                                        <div className="empty-text">Нет продуктов с низкими остатками</div>
                                    ) : (
                                        <>
                                            <p style={{marginBottom: '20px', color: 'var(--text-secondary)'}}>
                                                Продукты с низкими остатками будут добавлены в заказ
                                            </p>
                                            {lowStockProducts.map(p => (
                                                <div key={p.id} style={{marginBottom: '12px', padding: '12px', background: 'var(--bg-main)', borderRadius: '8px'}}>
                                                    <strong>{p.name}</strong> - {p.quantity} {p.unit}
                                                </div>
                                            ))}
                                            <button className="btn btn-primary" onClick={() => {
                                                handleOrderAll();
                                                setShowQuickOrder(false);
                                            }}>
                                                Создать заказ
                                            </button>
                                        </>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
